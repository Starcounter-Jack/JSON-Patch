/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * json-patch-duplex.js version: 1.2.1
 * (c) 2013 Joachim Wester
 * MIT license
 */
var jsonpatch;if(function(a){function b(a,c){switch(typeof a){case"undefined":case"boolean":case"string":case"number":return a===c;case"object":if(null===a)return null===c;if(p(a)){if(!p(c)||a.length!==c.length)return!1;for(var d=0,e=a.length;d<e;d++)if(!b(a[d],c[d]))return!1;return!0}for(var f=q(a),g=q(c),h=0;h<f.length;h++){var i=f[h];if(!b(a[i],c[i]))return!1;var j=g.indexOf(i);j>=0&&g.splice(j,1)}for(var k=0;k<g.length;k++){var l=g[k];if(!b(a[l],c[l]))return!1}return!0;default:return!1}}function c(a){for(var b,c=0,d=a.length;c<d;){b=a.charCodeAt(c);{if(!(b>=48&&b<=57))return!1;c++}}return!0}function d(a){switch(typeof a){case"object":return JSON.parse(JSON.stringify(a));case"undefined":return null;default:return a}}function e(a){return-1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function f(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}function g(a,b){if(""==b)return a;var c={op:"_get",path:b};return h(a,c),c.value}function h(a,e,h,i){if(void 0===h&&(h=!1),void 0===i&&(i=!0),h&&("function"==typeof h?h(e,0,a,e.path):n(e,0)),""===e.path){var j={newDocument:a};if("add"===e.op)return j.newDocument=e.value,j;if("replace"===e.op)return j.newDocument=e.value,j.removed=a,j;if("move"===e.op||"copy"===e.op)return j.newDocument=g(a,e.from),"move"===e.op&&(j.removed=a),j;if("test"===e.op){if(j.test=b(a,e.value),!1===j.test)throw new t("Test operation failed","TEST_OPERATION_FAILED",0,e,a);return j.newDocument=a,j}if("remove"===e.op)return j.removed=a,j.newDocument=null,j;if("_get"===e.op)return e.value=a,j;if(h)throw new t("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,e,a);return j}i||(a=d(a));var k=e.path||"",l=k.split("/"),m=a,o=1,q=l.length,u=void 0,v=void 0,w=void 0;for(w="function"==typeof h?h:n;;){if(v=l[o],h&&void 0===u&&(void 0===m[v]?u=l.slice(0,o).join("/"):o==q-1&&(u=e.path),void 0!==u&&w(e,0,a,u)),o++,p(m)){if("-"===v)v=m.length;else{if(h&&!c(v))throw new t("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,e.path,e);v=~~v}if(o>=q){if(h&&"add"===e.op&&v>m.length)throw new t("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,e.path,e);var j=s[e.op].call(e,m,v,a);if(!1===j.test)throw new t("Test operation failed","TEST_OPERATION_FAILED",0,e,a);return j}}else if(v&&-1!=v.indexOf("~")&&(v=f(v)),o>=q){var j=r[e.op].call(e,m,v,a);if(!1===j.test)throw new t("Test operation failed","TEST_OPERATION_FAILED",0,e,a);return j}m=m[v]}}function i(a,b,c){for(var d=new Array(b.length),e=0,f=b.length;e<f;e++)d[e]=h(a,b[e],c),a=d[e].newDocument;return d.newDocument=a,d}function j(a,b,c){console.warn("jsonpatch.apply is deprecated, please use `applyPatch` for applying patch sequences, or `applyOperation` to apply individual operations.");for(var e=new Array(b.length),f=function(f,i){if(""==b[f].path&&"remove"!=b[f].op&&"test"!=b[f].op){var j;"replace"!=b[f].op&&"move"!=b[f].op||(e[f]=d(a)),"copy"!=b[f].op&&"move"!=b[f].op||(j=g(a,b[f].from)),"replace"!=b[f].op&&"add"!=b[f].op||(j=b[f].value),Object.keys(a).forEach(function(b){return delete a[b]}),Object.keys(j).forEach(function(b){return a[b]=j[b]})}else e[f]=h(a,b[f],c),e[f]=e[f].removed||e[f].test},i=0,j=b.length;i<j;i++)f(i,j);return e}function k(a,b){var c=h(a,b);if(!1===c.test)throw new t("Test operation failed","TEST_OPERATION_FAILED",0,b,a);return c.newDocument}function l(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}function m(a){if(void 0===a)return!0;if(a)if(p(a)){for(var b=0,c=a.length;b<c;b++)if(m(a[b]))return!0}else if("object"==typeof a)for(var d=q(a),e=d.length,b=0;b<e;b++)if(m(a[d[b]]))return!0;return!1}function n(a,b,c,d){if("object"!=typeof a||null===a||p(a))throw new t("Operation is not an object","OPERATION_NOT_AN_OBJECT",b,a,c);if(!r[a.op])throw new t("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",b,a,c);if("string"!=typeof a.path)throw new t("Operation `path` property is not a string","OPERATION_PATH_INVALID",b,a,c);if(0!==a.path.indexOf("/")&&a.path.length>0)throw new t('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",b,a,c);if(("move"===a.op||"copy"===a.op)&&"string"!=typeof a.from)throw new t("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",b,a,c);if(("add"===a.op||"replace"===a.op||"test"===a.op)&&void 0===a.value)throw new t("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",b,a,c);if(("add"===a.op||"replace"===a.op||"test"===a.op)&&m(a.value))throw new t("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",b,a,c);if(c)if("add"==a.op){var e=a.path.split("/").length,f=d.split("/").length;if(e!==f+1&&e!==f)throw new t("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",b,a,c)}else if("replace"===a.op||"remove"===a.op||"_get"===a.op){if(a.path!==d)throw new t("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",b,a,c)}else if("move"===a.op||"copy"===a.op){var g={op:"_get",path:a.from,value:void 0},h=o([g],c);if(h&&"OPERATION_PATH_UNRESOLVABLE"===h.name)throw new t("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",b,a,c)}}function o(a,b,c){try{if(!p(a))throw new t("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(b)i(d(b),d(a),c||!0);else{c=c||n;for(var e=0;e<a.length;e++)c(a[e],e,b,void 0)}}catch(a){if(a instanceof t)return a;throw a}}var p,q=function(a){if(p(a)){for(var b=new Array(a.length),c=0;c<b.length;c++)b[c]=""+c;return b}if(Object.keys)return Object.keys(a);var b=[];for(var d in a)a.hasOwnProperty(d)&&b.push(d);return b},r={add:function(a,b,c){return a[b]=this.value,{newDocument:c}},remove:function(a,b,c){var d=a[b];return delete a[b],{newDocument:c,removed:d}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:function(a,b,c){var e=g(c,this.path);e&&(e=d(e));var f=h(c,{op:"remove",path:this.from}).removed;return h(c,{op:"add",path:this.path,value:f}),{newDocument:c,removed:e}},copy:function(a,b,c){var e=g(c,this.from);return h(c,{op:"add",path:this.path,value:d(e)}),{newDocument:c}},test:function(a,c,d){return{newDocument:d,test:b(a[c],this.value)}},_get:function(a,b,c){return this.value=a[b],{newDocument:c}}},s={add:function(a,b,c){return a.splice(b,0,this.value),{newDocument:c,index:b}},remove:function(a,b,c){return{newDocument:c,removed:a.splice(b,1)[0]}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:r.move,copy:r.copy,test:r.test,_get:r._get};p=Array.isArray?Array.isArray:function(a){return a.push&&"number"==typeof a.length},a.deepClone=d,a.escapePathComponent=e,a.unescapePathComponent=f,a.getValueByPointer=g,a.applyOperation=h,a.applyPatch=i,a.apply=j,a.applyReducer=k;var t=function(a){function b(b,c,d,e,f){a.call(this,b),this.message=b,this.name=c,this.index=d,this.operation=e,this.tree=f}return l(b,a),b}(Error);a.JsonPatchError=t,a.validator=n,a.validate=o}(jsonpatch||(jsonpatch={})),void 0!==exports)exports.apply=jsonpatch.apply,exports.applyPatch=jsonpatch.applyPatch,exports.applyOperation=jsonpatch.applyOperation,exports.applyReducer=jsonpatch.applyReducer,exports.getValueByPointer=jsonpatch.getValueByPointer,exports.deepClone=jsonpatch.deepClone,exports.escapePathComponent=jsonpatch.escapePathComponent,exports.unescapePathComponent=jsonpatch.unescapePathComponent,exports.validate=jsonpatch.validate,exports.validator=jsonpatch.validator,exports.JsonPatchError=jsonpatch.JsonPatchError;else var exports={},isBrowser=!0;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=jsonpatch,isBrowser&&(exports=void 0);